// Starter check templates aligned to UK Fire Safety Order requirements
import { CheckTemplate, CheckField } from '@/types';

export const FIRE_ALARM_WEEKLY_TEMPLATE: Omit<CheckTemplate, 'id' | 'orgId' | 'createdAt' | 'updatedAt'> = {
  name: 'Fire Alarm – Weekly Test',
  description: 'Weekly test of fire detection and alarm system as per BS 5839-1',
  assetType: 'fire_alarm',
  frequency: 'weekly',
  rrule: 'FREQ=WEEKLY;BYDAY=MO',
  requiresEvidence: false,
  requiresGPS: true,
  requiresSignature: true,
  guidance: 'Operate one manual call point (MCP) in rotation each week. Ensure alarm sounds throughout premises and automatic release devices operate.',
  references: ['BS 5839-1:2017', 'Fire Safety Order Article 17'],
  version: 1,
  fields: [
    {
      id: 'mcp_id',
      label: 'Call point ID',
      type: 'text',
      required: true,
      guidance: 'Enter the manual call point number operated this week',
    },
    {
      id: 'releases_operated',
      label: 'Automatic door releases operated',
      type: 'boolean',
      required: true,
      guidance: 'Confirm fire doors held open automatically released on alarm',
    },
    {
      id: 'detector_zones',
      label: 'Detector zones showing',
      type: 'text',
      required: false,
      guidance: 'Note which zones displayed on control panel',
    },
    {
      id: 'result',
      label: 'Test result',
      type: 'enum',
      required: true,
      options: ['Pass', 'Fail'],
    },
    {
      id: 'faults',
      label: 'Faults found',
      type: 'text',
      required: false,
      guidance: 'Describe any faults: sounder issues, panel faults, non-functioning devices',
    },
    {
      id: 'actions',
      label: 'Actions taken',
      type: 'text',
      required: false,
      guidance: 'Note immediate actions taken and remedial work required',
    },
  ],
};

export const EMERGENCY_LIGHTING_MONTHLY_TEMPLATE: Omit<CheckTemplate, 'id' | 'orgId' | 'createdAt' | 'updatedAt'> = {
  name: 'Emergency Lighting – Monthly Function Test',
  description: 'Monthly function test of emergency escape lighting as per BS 5266-1',
  assetType: 'emergency_lighting',
  frequency: 'monthly',
  rrule: 'FREQ=MONTHLY;BYMONTHDAY=1',
  requiresEvidence: false,
  requiresGPS: true,
  requiresSignature: true,
  guidance: 'Simulate mains failure for short period. All emergency luminaires must illuminate.',
  references: ['BS 5266-1:2016', 'BS EN 50172:2004'],
  version: 1,
  fields: [
    {
      id: 'test_method',
      label: 'Test method',
      type: 'enum',
      required: true,
      options: ['Mains isolation', 'Key switch test', 'Auto test system'],
    },
    {
      id: 'luminaires_tested',
      label: 'Luminaires tested',
      type: 'text',
      required: false,
      guidance: 'Specify subset tested or "All" if whole system tested',
    },
    {
      id: 'all_illuminated',
      label: 'All luminaires illuminated',
      type: 'boolean',
      required: true,
    },
    {
      id: 'result',
      label: 'Test result',
      type: 'enum',
      required: true,
      options: ['Pass', 'Fail'],
    },
    {
      id: 'faults',
      label: 'Faulty luminaires',
      type: 'text',
      required: false,
      guidance: 'List location of non-functioning or dim luminaires',
    },
    {
      id: 'mitigations',
      label: 'Mitigations',
      type: 'text',
      required: false,
      guidance: 'Temporary measures until repair (e.g., torches provided)',
    },
    {
      id: 'rectified_date',
      label: 'Target rectification date',
      type: 'date',
      required: false,
    },
  ],
};

export const FIRE_DOOR_CHECK_TEMPLATE: Omit<CheckTemplate, 'id' | 'orgId' | 'createdAt' | 'updatedAt'> = {
  name: 'Fire Doors – Routine Inspection',
  description: 'Visual and functional check of fire doors and associated hardware',
  assetType: 'fire_door',
  frequency: 'monthly',
  rrule: 'FREQ=MONTHLY',
  requiresEvidence: true,
  requiresGPS: true,
  requiresSignature: true,
  guidance: 'Check door closes fully, seals intact, no gaps, signage present. Test hold-open release if fitted.',
  references: ['BS 9999:2017', 'Fire Safety Order'],
  version: 1,
  fields: [
    {
      id: 'door_closer',
      label: 'Self-closing device functional',
      type: 'enum',
      required: true,
      options: ['Pass', 'Fail', 'N/A'],
      guidance: 'Door must close fully and latch from any open position',
    },
    {
      id: 'intumescent_seals',
      label: 'Intumescent strips intact',
      type: 'enum',
      required: true,
      options: ['Pass', 'Fail', 'N/A'],
      guidance: 'Seals must be continuous with no gaps or damage',
    },
    {
      id: 'smoke_seals',
      label: 'Smoke seals intact',
      type: 'enum',
      required: true,
      options: ['Pass', 'Fail', 'N/A'],
    },
    {
      id: 'glazing',
      label: 'Glazing condition',
      type: 'enum',
      required: false,
      options: ['Pass', 'Fail', 'N/A'],
      guidance: 'Check for cracks, missing panes, correct fire-rated glass',
    },
    {
      id: 'gaps',
      label: 'Gaps around door',
      type: 'enum',
      required: true,
      options: ['Pass', 'Fail'],
      guidance: 'Gaps should not exceed 3mm (4mm at threshold)',
    },
    {
      id: 'hold_open_release',
      label: 'Hold-open device releases on alarm',
      type: 'enum',
      required: false,
      options: ['Pass', 'Fail', 'N/A'],
      guidance: 'Test only if door has hold-open device',
    },
    {
      id: 'signage',
      label: 'Fire door signage present',
      type: 'boolean',
      required: true,
    },
    {
      id: 'result',
      label: 'Overall result',
      type: 'enum',
      required: true,
      options: ['Pass', 'Fail'],
    },
    {
      id: 'defects',
      label: 'Defects noted',
      type: 'text',
      required: false,
      guidance: 'Describe any defects found',
    },
    {
      id: 'action_priority',
      label: 'Action priority',
      type: 'enum',
      required: false,
      options: ['Critical', 'High', 'Medium', 'Low'],
      guidance: 'Critical = door kept open/removed/non-functional',
    },
    {
      id: 'target_date',
      label: 'Target completion date',
      type: 'date',
      required: false,
    },
  ],
};

export const EXTINGUISHER_MONTHLY_TEMPLATE: Omit<CheckTemplate, 'id' | 'orgId' | 'createdAt' | 'updatedAt'> = {
  name: 'Fire Extinguishers – Monthly Visual Check',
  description: 'Monthly visual inspection of portable fire extinguishers as per BS 5306-3',
  assetType: 'extinguisher',
  frequency: 'monthly',
  rrule: 'FREQ=MONTHLY',
  requiresEvidence: false,
  requiresGPS: true,
  requiresSignature: true,
  guidance: 'Check extinguisher is in place, accessible, gauge in green zone, no damage.',
  references: ['BS 5306-3:2017'],
  version: 1,
  fields: [
    {
      id: 'in_position',
      label: 'In correct position and accessible',
      type: 'boolean',
      required: true,
    },
    {
      id: 'pressure_gauge',
      label: 'Pressure gauge reading',
      type: 'enum',
      required: true,
      options: ['Green zone', 'Red zone', 'N/A (no gauge)'],
      guidance: 'Gauge needle must be in green zone',
    },
    {
      id: 'tamper_seal',
      label: 'Tamper seal intact',
      type: 'boolean',
      required: true,
    },
    {
      id: 'physical_condition',
      label: 'Physical condition',
      type: 'enum',
      required: true,
      options: ['Good', 'Damage noted', 'Corrosion', 'Leaking'],
    },
    {
      id: 'mounting',
      label: 'Mounting bracket secure',
      type: 'boolean',
      required: true,
    },
    {
      id: 'signage_visible',
      label: 'Identification sign visible',
      type: 'boolean',
      required: true,
    },
    {
      id: 'last_service_date',
      label: 'Last service date (from label)',
      type: 'date',
      required: false,
    },
    {
      id: 'next_service_due',
      label: 'Next service due',
      type: 'date',
      required: false,
      guidance: 'Annual service required',
    },
    {
      id: 'result',
      label: 'Result',
      type: 'enum',
      required: true,
      options: ['Pass', 'Fail'],
    },
    {
      id: 'actions',
      label: 'Actions required',
      type: 'text',
      required: false,
      guidance: 'Note if service due, replacement needed, etc.',
    },
  ],
};

export const SPRINKLER_WEEKLY_TEMPLATE: Omit<CheckTemplate, 'id' | 'orgId' | 'createdAt' | 'updatedAt'> = {
  name: 'Sprinkler System – Weekly Check',
  description: 'Weekly inspection of sprinkler installation as per BS EN 12845',
  assetType: 'sprinkler',
  frequency: 'weekly',
  rrule: 'FREQ=WEEKLY;BYDAY=MO',
  requiresEvidence: false,
  requiresGPS: true,
  requiresSignature: true,
  guidance: 'Check water/air pressures, tank levels, pump operation, alarm functionality.',
  references: ['BS EN 12845:2015+A1:2019', 'LPC Rules'],
  version: 1,
  fields: [
    {
      id: 'water_pressure',
      label: 'Water pressure (bar)',
      type: 'number',
      required: true,
      validation: { min: 0, max: 20 },
    },
    {
      id: 'air_pressure',
      label: 'Air pressure (bar) if dry system',
      type: 'number',
      required: false,
      validation: { min: 0, max: 10 },
    },
    {
      id: 'tank_level',
      label: 'Water tank level',
      type: 'enum',
      required: true,
      options: ['Normal', 'Low', 'N/A'],
    },
    {
      id: 'motor_alarm',
      label: 'Motor alarm test',
      type: 'enum',
      required: true,
      options: ['Pass', 'Fail', 'N/A'],
    },
    {
      id: 'pump_auto_start',
      label: 'Pump auto-start test',
      type: 'enum',
      required: true,
      options: ['Pass', 'Fail', 'N/A'],
    },
    {
      id: 'diesel_restart',
      label: 'Diesel pump restart (if applicable)',
      type: 'enum',
      required: false,
      options: ['Pass', 'Fail', 'N/A'],
    },
    {
      id: 'trace_heating',
      label: 'Trace heating operational',
      type: 'enum',
      required: false,
      options: ['Yes', 'No', 'N/A'],
    },
    {
      id: 'battery_check',
      label: 'Control panel batteries',
      type: 'enum',
      required: false,
      options: ['Good', 'Fault', 'N/A'],
    },
    {
      id: 'result',
      label: 'Overall result',
      type: 'enum',
      required: true,
      options: ['Pass', 'Fail'],
    },
    {
      id: 'defects',
      label: 'Defects noted',
      type: 'text',
      required: false,
    },
    {
      id: 'actions',
      label: 'Actions taken',
      type: 'text',
      required: false,
    },
  ],
};

export const FALSE_ALARM_LOG_TEMPLATE: Omit<CheckTemplate, 'id' | 'orgId' | 'createdAt' | 'updatedAt'> = {
  name: 'False Alarm Log',
  description: 'Record of unwanted fire signals for trend analysis',
  assetType: 'fire_alarm',
  frequency: 'daily',
  rrule: 'FREQ=DAILY',
  requiresEvidence: false,
  requiresGPS: false,
  requiresSignature: false,
  guidance: 'Log all false alarms to identify patterns and reduce unwanted signals.',
  references: ['BS 5839-1:2017 Clause 45'],
  version: 1,
  fields: [
    {
      id: 'trigger_type',
      label: 'Trigger type',
      type: 'enum',
      required: true,
      options: ['MCP', 'Detector', 'Panel fault', 'Other'],
    },
    {
      id: 'location',
      label: 'Location',
      type: 'text',
      required: true,
      guidance: 'Specific location of trigger device',
    },
    {
      id: 'category',
      label: 'Category',
      type: 'enum',
      required: true,
      options: [
        'Unwanted (cooking/steam/dust)',
        'Equipment fault',
        'Accidental (system test)',
        'Malicious',
        'Good intent',
      ],
    },
    {
      id: 'cause',
      label: 'Cause',
      type: 'text',
      required: true,
      guidance: 'Describe cause in detail',
    },
    {
      id: 'actions',
      label: 'Actions taken',
      type: 'text',
      required: true,
      guidance: 'Immediate actions and preventive measures',
    },
    {
      id: 'responsible_person',
      label: 'Person dealing with incident',
      type: 'text',
      required: true,
    },
    {
      id: 'follow_up_due',
      label: 'Follow-up action due date',
      type: 'date',
      required: false,
    },
  ],
};

export const TRAINING_DRILL_TEMPLATE: Omit<CheckTemplate, 'id' | 'orgId' | 'createdAt' | 'updatedAt'> = {
  name: 'Fire Training & Drill Record',
  description: 'Record of fire safety training and evacuation drills',
  assetType: undefined,
  frequency: 'quarterly',
  rrule: 'FREQ=MONTHLY;INTERVAL=3',
  requiresEvidence: true,
  requiresGPS: false,
  requiresSignature: true,
  guidance: 'Record all fire training sessions and evacuation drills. Attach sign-in sheets.',
  references: ['Fire Safety Order Article 21', 'BS 9999:2017'],
  version: 1,
  fields: [
    {
      id: 'type',
      label: 'Type',
      type: 'enum',
      required: true,
      options: ['Induction', 'Refresher training', 'Evacuation drill', 'Fire warden training'],
    },
    {
      id: 'duration',
      label: 'Duration (minutes)',
      type: 'number',
      required: true,
      validation: { min: 5, max: 480 },
    },
    {
      id: 'syllabus',
      label: 'Syllabus/Content covered',
      type: 'text',
      required: true,
      guidance: 'Key topics covered during session',
    },
    {
      id: 'assessor',
      label: 'Trainer/Assessor name',
      type: 'text',
      required: true,
    },
    {
      id: 'attendee_count',
      label: 'Number of attendees',
      type: 'number',
      required: true,
      validation: { min: 1 },
    },
    {
      id: 'outcomes',
      label: 'Outcomes/Notes',
      type: 'text',
      required: false,
      guidance: 'Any issues noted, lessons learned, improvements needed',
    },
    {
      id: 'next_due',
      label: 'Next training due',
      type: 'date',
      required: false,
    },
  ],
};

// Export all templates as array
export const DEFAULT_CHECK_TEMPLATES = [
  FIRE_ALARM_WEEKLY_TEMPLATE,
  EMERGENCY_LIGHTING_MONTHLY_TEMPLATE,
  FIRE_DOOR_CHECK_TEMPLATE,
  EXTINGUISHER_MONTHLY_TEMPLATE,
  SPRINKLER_WEEKLY_TEMPLATE,
  FALSE_ALARM_LOG_TEMPLATE,
  TRAINING_DRILL_TEMPLATE,
];
